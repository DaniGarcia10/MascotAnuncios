<div class="card mb-4 shadow-sm">
  <a [routerLink]="['/anuncios', anuncio.id]" class="text-decoration-none text-dark">
    <div class="row g-0">
      
      <!-- Imagen -->
      <div class="col-md-4 position-relative">
        <div class="w-100" style="height: 300px; overflow: hidden; background-color: transparent;">
          <img *ngIf="anuncio.imagenes?.length"
               [src]="anuncio.imagenes[0]"
               class="w-100 h-100 object-fit-contain rounded-start"
               style="object-fit: contain;"
               alt="Imagen del anuncio">
          <div *ngIf="anuncio.imagenes?.length > 1"
               class="position-absolute bottom-0 end-0 m-1 px-2 py-1 bg-dark text-white rounded small"
               style="z-index: 10;">
            +{{ anuncio.imagenes.length - 1 }} imágenes más
          </div>
        </div>
      </div>

      <!-- Contenido + Footer -->
      <div class="col-md-8 d-flex flex-column justify-content-between">
        <div class="card-body pb-2 pt-2">
          <p class="card-text mb-1 text-truncate">
            <i class="bi bi-clock me-1"></i>{{ calcularTiempoTranscurrido(anuncio.fecha_publicacion) }}
          </p>
          <h5 class="card-title fw-bold fs-6 mb-1 text-truncate"
              style="overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
            {{ anuncio.titulo }}
          </h5>
          <p class="card-text mb-1 text-truncate">
            <strong>
              <!-- Mostrar rango de precios o precio único -->
              <ng-container *ngIf="anuncio?.especificar_cachorros; else precioUnico">
                <ng-container *ngIf="precioMinimo && precioMaximo && precioMinimo !== precioMaximo">
                  {{ precioMinimo + '€ - ' + precioMaximo + '€' }}
                </ng-container>
                <ng-container *ngIf="precioMinimo && precioMaximo && precioMinimo === precioMaximo">
                  {{ precioMinimo + '€' }}
                </ng-container>
              </ng-container>
              <ng-template #precioUnico>
                {{ anuncio.precio }}€
              </ng-template>
            </strong>
          </p>
          <span class="badge bg-secondary mb-2">{{ anuncio.raza }}</span>
          <p class="card-text mb-2 small text-truncate">
            <i class="bi bi-cake"></i> {{ anuncio.edad }}
          </p>
          <p class="card-text mb-2 small text-truncate">
            <i class="bi bi-geo-alt"></i> {{ anuncio.ubicacion }}
          </p>
          
          <p class="card-text mb-2 small"
             style="overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
            {{ anuncio.descripcion }}
          </p>
        </div>

        <!-- Footer (máx. 2 líneas) -->
        <div class="card-footer bg-light text-muted d-flex align-items-center py-2 px-3 border-top mt-auto"
             style="overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
          <div class="me-3">
            <img *ngIf="imagenUrlCriadero" [src]="imagenUrlCriadero" alt="Foto del criadero" class="border rounded"
                 style="width: 45px; height: 45px; object-fit: cover;">
          </div>
          <div class="small">
            <div><strong>Criadero:</strong> {{ criaderoData?.nombre }}</div>
            <div><strong>Núcleo zoológico:</strong> {{ criaderoData?.nucleo_zoologico }}</div>
          </div>
        </div>
      </div>
    </div>
  </a>
</div>
